<!DOCTYPE html>
<html lang="en">
<head>
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>    
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script type="text/javascript">
       if({{{myJSON2}}} != 0){ google.charts.load('current', {'packages':['corechart']});
        google.charts.setOnLoadCallback(drawChart);}
        if({{{myJSONorgchart}}} != 0){
        google.charts.load('current', {'packages':['orgchart']});
        google.charts.setOnLoadCallback(drawChart2);}
        if({{{myJSON}}} != 0){
        google.charts.load('current', {'packages': ['corechart', 'bar']});
        google.charts.setOnLoadCallback(drawChart3);}

	//PIE CHART
        function drawChart() {
        var g = new Array();
        g.push([]);
        g[0][0] = "something";
	g[0][1] = "else";
	
        var da = {{{myJSON2}}};
        if(da.length == 1){
        	g.push([]);
	        g[1][0] = da[0][0];
		g[1][1] = da[0][1];
        }
        else{
        	for(var i = 1; i <= da.length; i++){
       			g.push([]);
		        g[i][0] = da[i-1][0];
			g[i][1] = da[i-1][1];
        	}
        }
        var data = google.visualization.arrayToDataTable(g);
        var options = {
           title: '',
            height: 300,
               width: 450,
           
        };
  
          var chart = new google.visualization.PieChart(document.getElementById('piechart'));
  
          chart.draw(data, options);
      }
      
      //ORGANIZATION CHART
      function drawChart2() {
	var da = {{{myJSONorgchart}}};
        var data = new google.visualization.DataTable();
        data.addColumn('string', 'Name');
        data.addColumn('string', 'Manager');
        data.addColumn('string', 'ToolTip');
        var p = 'Admin:';
        var q = p + da[0][2].toString();
        data.addRow([q,'', '']);
        for(var i = 0; i < da.length; i ++){
           data.addRow([da[i][1], q, '']); 
        }
        // Create the chart.
        var chart = new google.visualization.OrgChart(document.getElementById('chart_div'));
        // Draw the chart, setting the allowHtml option to true for the tooltips.
        chart.draw(data, {allowHtml:true});
      }
      
      //TIMELINE
      function drawChart3() {
             var g = new Array();
	     g.push([]);
	     g[0][0] = "Date";
	     g[0][1] = "# Created";
	     var da = {{{myJSON}}};
	     var min = 99999999999999999;
	     var max = -1;
	     for(var i = 1; i <= da.length; i ++){
		g.push([]);
		if(min > da[i-1][1]){
			min = da[i-1][1];
		}
		if(max < da[i-1][1]){
			max = da[i-1][1];
		}
	        g[i][0] = da[i-1][0];
	     	g[i][1] = da[i-1][1];
             }
	     var data = google.visualization.arrayToDataTable(g);
             var options = {
            //   title: '{{{chartTitle}}}',
               height: 300,
               width: 450,
	       chartArea: {
		      // allow 70px for hAxis title and ticks
		      height: 200,

		      // allow 200px for vAxis title and ticks
		      left: 200,
		      // allow 50px for chart title
		      top: 25,

		      // allow 200px for legend on right
		      width: 250
	    	},               
		  hAxis: {
                  ticks: [0, 1, 2, 3, 4, 5], 
               	  format: '0',
               	  title: 'number created'
               },
               vAxis: {
                  title: 'date',
                  
               }
             };
             var chart = new google.visualization.BarChart(document.getElementById('chart_div_time'));
             chart.draw(data, options);
       }
      
   </script>
  <link href="../starter-template.css" rel="stylesheet">
 </head>

<body>
  <nav class="navbar fixed-top navbar-expand-lg navbar-dark bg-dark">
    <a class="navbar-brand" href="#">Employee Recognition Awards System</a> 
    <button aria-controls="navbarNavDropdown" aria-expanded="true" aria-label="Toggle navigation" class="navbar-toggler" data-target="#navbarNavDropdown" data-toggle="collapse" type="button"><span class="navbar-toggler-icon"></span></button>
    <div class="collapse navbar-collapse" id="navbarNavDropdown">
      <ul class="navbar-nav">
        <li class="nav-item" >
          <a class="nav-link" href="/adminProfile">My Profile <span class="sr-only">(current)</span></a>
        </li>
        <li class="nav-item" >
          <a class="nav-link" href="/accountsMain">Accounts <span class="sr-only">(current)</span></a>
        </li>
        <li class="nav-item active" >
          <a class="nav-link" href="/businessIntelligence">BI Reports</a>
        </li>
          
      </ul>
    </div>
              <a href="/logout" >Sign out</a>
  </nav>
  <div class="container-fluid" s>
    <div class="row">
      <nav class="col-md-2 d-none d-md-block bg-light sidebar">
        <h3>{{{title}}}</h3>
        <div class="sidebar-sticky">
          <ul class="nav flex-column">
            <li class="nav-item">
          <form action="/businessIntelligence" method="post">

              <div class="bs-example">
	          <div class="panel-group" id="accordion">
	              <div class="panel panel-default">
	                 <div class="panel-heading">
	                    <a class="panel-title">
			       <a id="sidebar" data-toggle="collapse" data-parent="#accordion" href="#collapseOne">
			         <span class="glyphicon glyphicon-plus"></span> Admins</a>
			    </a>
			</div>
			<div id="collapseOne" class="panel-collapse collapse">
			<div class="panel-body" id="panel-body" name="panel-body">
			<input type="radio" name="adminRadio" value="allAdmins"> All Admins <br>
			<input type="radio" name="adminRadio" value="adminId"> Admin ID = <input type="text" name="adminIdText" /><br>
			</div>
	                </div>
	              </div>
	              <div class="panel panel-default">
	                  <div class="panel-heading">
                          <a class="panel-title">
                             <a id="sidebar" data-toggle="collapse" data-parent="#accordion" href="#collapseTwo"><span class="glyphicon glyphicon-plus"></span> Users </a>
                         </a>
     	                  </div>
     	                  <div id="collapseTwo" class="panel-collapse collapse">
     	                      <div class="panel-body" id="panel-body" name="panel-body">
    	                            <input type="radio" name="userRadio" value="allUsers"/ > All Users <br>
      			 <input type="radio" name="userRadio" value="userId"/> User ID = <input type="text" id="userIdText" name="userIdText" /><br>
	                      </div>
                          </div>
                       </div>
	              <div class="panel panel-default">
	                  <div class="panel-heading">
	                      <a class="panel-title">
	                          <a id="sidebar" data-toggle="collapse" data-parent="#accordion" href="#collapseThree"><span class="glyphicon glyphicon-plus"></span> Awards</a>
	                      </a>
	                  </div>
	                  <div id="collapseThree" class="panel-collapse collapse">
	                      <div class="panel-body" id="panel-body" name="panel-body">
				     <input type="radio" name="awardRadio" value="allAwards"> All Awards <br>
				    <input type="radio" name="awardRadio" value="awardId"> Award ID = <input type="text" name="awardIdText" /><br>
				  </div>
	                  </div>
	              </div>
	          </div>
	          <div><br>
     		 <button type="submit" id="generateReport" name="generateReport" value="Generate Report" >Generate Report</button> 
</div>
	<a class="nav-link" href="/businessIntelligence">Reset Form</a>
	</form>
	</div>
        </li>
          </ul>
        </div>
      </nav>
      <main role="main" class="col-md-9 ml-sm-auto col-lg-10 pt-3 px-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom">
                  <h1 class="h2">Dashboard</h1>
            <div class="btn-toolbar mb-2 mb-md-0">
            {{#if chartTitle}}
                <form method="post" action="/businessIntelligence">
                   <input type="hidden" name="thisReport" id="thisReport" value="{{{thisReport}}}" />
		   <button type="submit" class="btn btn-sm btn-outline-secondary" name="exportButton" id="exportButton">Export</button>
                </form>
		{{/if}}
	     </div>
              
            </div>
            
        
        <h5 >{{{exportCSV}}} </h5>
        {{{searchtitle}}}
       <div class="d-md-flex flex-md-equal w-100 my-md-3 pl-md-3">
	{{#if chartTitle}}
          <div class="bg-light mr-md-1 pt-1 px-1 pt-md-1 px-md-1 text-center overflow-hidden">
              <div class="my-1 py-1">
              <div id="chart_div_time" name="chart_div_time" class="chart_div_time" ></div>

                <p class="lead">{{{chartTitle}}}</p>
              </div>
            </div>
            {{/if}}
            {{#if chartTitle2}}
            <div class="bg-light mr-md-1 pt-1 px-1 pt-md-1 px-md-1 text-center overflow-hidden">
              <div class="my-1 p-1">
         <div id="piechart" ></div>
                                 <div id="chart_div" ></div>


                <p class="lead">{{{chartTitle2}}}</p>
              </div>
            </div>
                {{/if}}

    </div>
                        <div id="chart_div" ></div>

                    <div id="chart_div_time" ></div>
         <div id="piechart" ></div>

        {{#if admins}}
 	<h4>Admins:</h4>
        <div class="table">
         <table class="table table-striped table-sm">
           <thead>
             <tr>
               <th>ID</th>
               <th>Email</th>
               <th>Login Attempts</th> 
               <th>Last Login</th>
               <th>Creation Time</th>
               <th>Creator ID</th>

               </tr>
           </thead>
           <tbody>
           {{#each admins}}
             <tr>
               <td>{{this.id}}</td>
               <td>{{this.email}}</td>
               <td>{{this.login_attempts}}</td>
               <td>{{this.last_login}}</td>
               <td>{{this.creation_time}}</td>
               <td>{{this.creator_id}}</td>
            </tr>
           {{/each}}
           </tbody>
          </table>{{/if}}
	          
    {{#if usersAndAwards}} 
    <h4>Awards Created by Users:</h4>
       <div class="table">
          <table class="table table-striped table-sm">
            <thead>
              <tr>
                <th>ID</th>
                <th>Recipient Name</th>
                <th>Recipient Email</th>
                <th>Creation Time</th>
                <th>Award Type</th>
                <th>Creator ID</th>
              </tr>
            </thead>
            <tbody>
            {{#each usersAndAwards}}
              <tr>
                <td>{{this.id}}</td>
                <td>{{this.recipient_name}}</td>
                <td>{{this.recipient_email}}</td>
                <td>{{this.creation_time}}</td>
         	<td>{{this.award_type}}</td>
        	<td>{{this.creator_id}}</td>
              </tr>
            {{/each}}
            </tbody>
           </table>{{/if}}
        
        {{#if users}} 
	<h4>Users:</h4>
        <div class="table">
          <table class="table table-striped table-sm">
            <thead>
              <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Email</th>
                <th>Password</th>
                <th>Region</th>
                <th>Last Login</th>
                <th>Login Attempts</th>
                <th>Signature</th>
                <th>Creation Time</th>
		<th>Creator ID</th>
                
              </tr>
            </thead>
            <tbody>
            {{#each users}}
              <tr>
                <td>{{this.id}}</td>
                <td>{{this.name}}</td>
                <td>{{this.email}}</td>
                <td>{{this.password}}</td>
                <td>{{this.region}}</td>
                <td>{{this.last_login}}</td>
                <td>{{this.login_attempts}}</td>
                <td>{{this.sig_image}}</td>
                <td>{{this.creation_time}}</td>
                <td>{{this.creator_id}}</td>
              </tr>
              {{/each}}
            </tbody>
          </table>{{/if}}
         
        {{#if awards}} 
	<h4>Awards:</h4>
	<div class="table">
	<table class="table table-striped table-sm">
	<thead>
	  <tr>
   	   <th>ID</th>
	   <th>Recipient Name</th>
	   <th>Recipient Email</th>
	   <th>Creation Time</th>
	   <th>Award Type</th>
	   <th>Creator ID</th>
	  </tr>
	</thead>
	<tbody>
	{{#each awards}}
	<tr>
	   <td>{{this.id}}</td>
	   <td>{{this.recipient_name}}</td>
	   <td>{{this.recipient_email}}</td>
	   <td>{{this.creation_time}}</td>
	   <td>{{this.award_type}}</td>
	   <td>{{this.creator_id}}</td>
	</tr>
	{{/each}}
	</tbody>
	</table>{{/if}}
	</div>
	</div></div>
        </div>
      </main>
    </div>
  </div>
  
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js">
  </script> 
  <script>
    window.jQuery || document.write('<script src="../../assets/js/vendor/jquery-slim.min.js"><\/script>')
  </script> 
</body>
</html>